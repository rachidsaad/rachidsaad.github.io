<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Reddit</title>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
	<script src="https://paste.fizi.ca/js/sjcl-1.0.7.js"></script>
	<script src="https://paste.fizi.ca/js/base64-2.4.5.js"></script>
	<script src="https://paste.fizi.ca/js/rawdeflate-0.5.js"></script>
	<script src="https://paste.fizi.ca/js/rawinflate-0.3.js"></script>
	
	<!-- <script src="https://paste.imirhil.fr/js/sjcl-1.0.4.js"></script>
	<script src="https://paste.imirhil.fr/js/base64-2.1.9.js"></script>
	<script src="https://paste.imirhil.fr/js/rawdeflate-0.5.js"></script>
	<script src="https://paste.imirhil.fr/js/rawinflate-0.3.js"></script> -->

</head>
<body>
	<span id='showBar' class="icones  icon-x-square"></span>
	<div id="switsh">
		<ul>
			<li class='icones icon-moon'></li>
			<li class='icones icon-sun'></li>
			<li class='icones icon-chevron-thin-up' id='top'></li>
			<li class='icones icon-search2' id='showsearch'></li>
			<span id='search'>
				<li><input type="text" placeholder="Novel Name" id='textfield'></li>
				<li class="icones icon-search2" id="reddit_search"></li>
			</span>
		</ul>
	</div>

	<div id="wrap">

		<header>
			<a href="index.html"><img src="img/lmp.png" alt=""><h1>UndeRGrounD</h1></a>
			<p>A greedy father has thieves for children</p>
		</header>

		<div id="main">

			<div id="search_results" class="updates">
				<ul>
					<li>
						<h1>Search results:</h1>
						<img id="spin" src="imgs/spin.gif" alt="">
						<span class='icones icon-close'></span>
					</li>
				</ul>
			</div>

			<div id="novelinfo" class="updates">
				<ul>
					<li>
						<span class='icones icon-close'></span>
					</li>
				</ul>
			</div>

			<div id="updates" class="updates">
				<ul>
					<li>
						<h1>
							<span class='icones icon-rotate-cw' data-action='ReFresh'>
							</span>Latest Updates:
						</h1>
					</li>
				</ul>
			</div>
		</div>

		<div id="side">
			<div id="novellist" class="updates">
				<ul>
					<li><h1>Novel list:</h1></li>
				</ul>
			</div>
		</div>

	</div>

	<div id="reader">
		<div class="text"></div>
		<span class='icones icon-chevron-thin-up' id='redertop'></span>
	</div>

	<script src="main.js"></script>
	<script>
		$(document).ready(function(){
			var updates = 'updates';
			var url  = 'https://www.reddit.com/r/QidianUnderground/new.json?',
				limit = 100;

			getData('',url,limit,updates);
			
			$('.icon-rotate-cw').on('click', function(){
				$('img#spin').show();
				$('#'+updates+ ' ul li:gt(0)').remove()
				getData('',url,limit,updates);							
			});

			$('#novelinfo .icon-close, #search_results .icon-close').on('click',function(){

				toHide    = $(this).parents('.updates').attr('id');
				ittSearch = window.novelInfoittSearch;

				if(toHide == 'search_results'){
					divToShow = localStorage.getItem('divTohide');
					$('#'+toHide+' ul li:gt(0)').remove();
					$('#'+toHide).hide();
					$('#'+divToShow).show();
					$('#showsearch ,#search').show();
				}else if(toHide == 'novelinfo' && ittSearch){
					$('#'+toHide+' ul li:eq(0) h1').remove();
					$('#'+toHide+' ul li:gt(0)').remove();
					window.novelInfoittSearch = false;
					$('#search_results').show();
					$('#'+toHide).hide();
				}
				else{
					scroll = localStorage.getItem("scroll");				
					$('#'+toHide+' ul li:eq(0) h1').remove();
					$('#'+toHide+' ul li:gt(0)').remove();
					$('#'+updates).show();
					$('#'+toHide).hide();
					$('body,html').animate({scrollTop:scroll},300);
				}

			});
			// novelList(link,'60','novellist');

			$('#showsearch').on('click', function(){
				$('#search').toggle();
				$(this).toggleClass('icon-close');
				$('#textfield').val('').css('border-bottom-color','');
				$('#textfield').focus();
			});
			$('#reddit_search').on('click', function(){
				var textfield    = $('#textfield'),
					textfieldVal = $(textfield).val().replace(/[^\w'â€™\s]/gi, '').trim();

				if(textfieldVal && textfieldVal.length>2 && !$.isNumeric(textfieldVal)){
					textfield.css('border-bottom-color','initial');

					divTohide = $('.updates:visible:eq(0)').attr('id');

					$('#'+divTohide).hide();
					$('#search_results ul li:gt(0)').remove();
					$('#search_results, #search_results li:eq(0) img').show();
					$('#showsearch ,#search').hide();
					link = "https://www.reddit.com/r/QidianUnderground/search.json?";
					getData(textfieldVal,link,30,'search_results');

					if(divTohide == 'novelinfo'){
						$('#'+divTohide+' ul li:eq(0) h1').remove();
						$('#'+divTohide+' ul li:gt(0)').remove();
						localStorage.setItem("divTohide",'updates');
					}
					else{
						localStorage.setItem("divTohide",divTohide);
					}

				}else{
					textfield.css('border-bottom-color','#ff0a0a');
					textfield.val('').focus();
				}
			});

			$('.icon-moon').on('click', function(){
				$('body,#updates, #switsh ul, header, #reader span.icon-close,.updates, span.numbers, #reader, .text, input#textfield').addClass('night');
				$('header img').attr('src','img/nmp.png');
				$(".icon-sun").css('display','inline-block');
				$(this).hide();
			});
			$('.icon-sun').on('click', function(){
				$('body,#updates, #switsh ul, header, #reader span.icon-close,.updates, span.numbers, #reader, .text, input#textfield').removeClass('night');
				$('header img').attr('src','img/lmp.png');
				$(".icon-moon").show();
				$(this).hide();
			});

			// $('#switsh ul li').on('click', function(){
			// 	if($(this).hasClass('icon-moon')){
			// 		$('body,#updates, #switsh ul, header a, header a img, header p, #reader span.icon-close,.updates, span.numbers, #reader, .text, input#textfield').addClass('night');
			// 		$('header img').attr('src','img/nmp.png');
			// 		$(".icon-sun").css('display','inline-block');
			// 		$(this).hide();
					
			// 	}else if($(this).hasClass('icon-sun')){
			// 		$('body,#updates, #switsh ul, header a, header a img, header p, #reader span.icon-close,.updates, span.numbers, #reader, .text, input#textfield').removeClass('night');
			// 		$('header img').attr('src','img/lmp.png');
			// 		$(".icon-moon").show();
			// 		$(this).hide();
			// 	}
			// });

			$('#showBar').on('click', function(){
				$('#switsh').toggle();
				$(this).toggleClass('icon-plus-square');
			});
			$('#top,#redertop').on('click', function(){
				$('body,html').animate({scrollTop:0},300);
			});
			$(window).on('scroll',function(){
				$(window).scrollTop()>=400?$('#top,#redertop').css('display','initial'):$('#top,#redertop').hide();
			});
		});
	</script>
</body>
</html>